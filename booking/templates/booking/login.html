{% extends 'base.html' %}

{% block title %}登录切换{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="login-container">
        <!-- 登录方式切换标签 -->
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#code-login">验证码登录</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#password-login">密码登录</a>
            </li>
        </ul>

        <!-- 地区限制提示 -->
        <div class="text-muted small mb-3">你所在地区仅支持手机号登录</div>

        <!-- 登录内容区域 -->
        <div class="tab-content">
            <!-- 验证码登录 -->
            <div class="tab-pane fade show active" id="code-login">
                <form method="post" action="{% url 'login' %}">
                    {% csrf_token %}
                    <input type="hidden" name="login_type" value="code">
                    <div class="mb-3 input-group">
                        <span class="input-group-text" style="width: 60px;">+86</span>
                        <input type="tel" class="form-control" name="phone" placeholder="请输入手机号" required>
                    </div>
                    <div class="mb-3 input-group">
                        <input type="text" class="form-control" name="code" placeholder="请输入验证码" required>
                        <button type="button" class="btn btn-outline-secondary send-code-btn">发送验证码</button>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">登录</button>
                </form>
                <div class="text-muted small mt-3">未注册的手机号将自动注册</div>
            </div>

            <!-- 密码登录 -->
            <div class="tab-pane fade" id="password-login">
                <form method="post" action="{% url 'login' %}">
                    {% csrf_token %}
                    <input type="hidden" name="login_type" value="password">
                    <div class="mb-3">
                        <input type="text" class="form-control" name="phone" placeholder="请输入手机号" required>
                    </div>
                    <div class="mb-3 input-group">
                        <input type="password" class="form-control" name="password" placeholder="请输入密码" required>
                        <span class="input-group-text" style="cursor: pointer;"><i class="bi bi-eye"></i></span>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">登录</button>
                </form>
                <div class="d-flex justify-content-between mt-3">
                    <a href="{% url 'password_reset' %}" class="text-muted small">忘记密码</a>
                    <a href="#" class="text-muted small">立即注册</a>
                </div>
            </div>
        </div>

        <!-- 协议声明 -->
        <div class="text-center small mt-4">
            注册登录即代表同意 <a href="{% url 'terms' %}" class="text-primary">用户协议</a> 与 <a href="{% url 'privacy' %}" class="text-primary">隐私政策</a>
        </div>
    </div>
</div>

<!-- Bootstrap 5 JS 及依赖 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- 自定义交互逻辑 -->
<script>
    // 验证码发送倒计时
    document.querySelector('.send-code-btn').addEventListener('click', function() {
        let btn = this;
        btn.disabled = true;
        let seconds = 60;
        const timer = setInterval(() => {
            btn.textContent = `重新发送(${seconds}s)`;
            seconds--;
            if (seconds < 0) {
                clearInterval(timer);
                btn.disabled = false;
                btn.textContent = '发送验证码';
            }
        }, 1000);
        
        // 发送验证码请求
        const phone = document.querySelector('#code-login input[name="phone"]').value;
        fetch("{% url 'send_code' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({phone: phone})
        });
    });

    // 密码显示切换
    document.querySelectorAll('.input-group-text').forEach(icon => {
        icon.addEventListener('click', () => {
            const input = icon.previousElementSibling;
            input.type = input.type === 'password' ? 'text' : 'password';
        });
    });
</script>

{% endblock %}
